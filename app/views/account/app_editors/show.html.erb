<div class="h-screen flex flex-col bg-gray-900">
  <!-- Header -->
  <div class="bg-gray-800 border-b border-gray-700 px-4 py-2 flex items-center justify-between">
    <div class="flex items-center space-x-4">
      <%= link_to account_team_apps_path(@app.team), class: "text-gray-400 hover:text-white" do %>
        <i class="fas fa-arrow-left"></i>
      <% end %>
      <h1 class="text-white font-semibold"><%= @app.name %></h1>
      <span class="text-xs text-gray-500">
        <%= @app.framework.upcase %> â€¢ <%= @app.app_type&.humanize %>
      </span>
    </div>
    
    <div class="flex items-center space-x-4">
      <% if @app.preview_url.present? %>
        <%= link_to @app.preview_url, target: "_blank", class: "text-sm text-gray-400 hover:text-white" do %>
          <i class="fas fa-external-link-alt mr-1"></i> Open Preview
        <% end %>
      <% end %>
      <button class="text-sm bg-primary-600 text-white px-3 py-1 rounded hover:bg-primary-700">
        <i class="fas fa-cloud-upload-alt mr-1"></i> Deploy
      </button>
    </div>
  </div>
  
  <!-- Main Content -->
  <div class="flex-1 flex overflow-hidden">
    <!-- Left Panel - Chat -->
    <div class="w-96 bg-gray-800 border-r border-gray-700 flex flex-col">
      <!-- Chat Header -->
      <div class="px-4 py-3 border-b border-gray-700">
        <h2 class="text-white font-medium">AI Assistant</h2>
        <p class="text-xs text-gray-400">Describe changes to make to your app</p>
      </div>
      
      <!-- Chat Messages -->
      <div class="flex-1 overflow-y-auto p-4" id="chat_container">
        <%= turbo_stream_from "app_#{@app.id}_chat" %>
        <div id="chat_messages" class="space-y-4">
          <% if @messages.any? %>
            <% @messages.each do |message| %>
              <%= render "chat_message", message: message %>
            <% end %>
          <% else %>
            <div class="text-center text-gray-500 py-8">
              <p class="mb-4">ðŸ‘‹ Hi! I'm ready to help you build your app.</p>
              <div class="text-sm space-y-2">
                <p>Try asking me to:</p>
                <p class="text-gray-400">"Add a navigation menu"</p>
                <p class="text-gray-400">"Change the color scheme to dark mode"</p>
                <p class="text-gray-400">"Make it mobile responsive"</p>
              </div>
            </div>
          <% end %>
        </div>
      </div>
      
      <!-- Chat Input -->
      <div class="p-4 border-t border-gray-700" id="chat_form">
        <%= render "chat_form", app: @app %>
      </div>
    </div>
    
    <!-- Right Panel - Preview/Code -->
    <div class="flex-1 bg-gray-900 flex flex-col">
      <!-- Tabs -->
      <div class="bg-gray-800 border-b border-gray-700 px-4 flex items-center space-x-1"
           data-controller="tabs">
        <button class="px-4 py-2 text-sm font-medium text-white border-b-2 border-primary-500"
                data-tabs-target="tab"
                data-panel="preview"
                data-action="click->tabs#switchTab">
          <i class="fas fa-eye mr-2"></i>Preview
        </button>
        <button class="px-4 py-2 text-sm font-medium text-gray-400 hover:text-white border-b-2 border-transparent"
                data-tabs-target="tab"
                data-panel="code"
                data-action="click->tabs#switchTab">
          <i class="fas fa-code mr-2"></i>Code
        </button>
        <button class="px-4 py-2 text-sm font-medium text-gray-400 hover:text-white border-b-2 border-transparent"
                data-tabs-target="tab"
                data-panel="files"
                data-action="click->tabs#switchTab">
          <i class="fas fa-folder mr-2"></i>Files (<%= @files.count %>)
        </button>
      </div>
      
      <!-- Tab Panels -->
      <div class="flex-1 overflow-hidden">
        <!-- Preview Panel -->
        <div class="h-full" data-tabs-target="panel" data-panel-name="preview">
          <%= render "preview_frame", app: @app %>
        </div>
        
        <!-- Code Panel -->
        <div class="h-full hidden" data-tabs-target="panel" data-panel-name="code">
          <div class="h-full flex">
            <!-- File Tree -->
            <%= render "file_tree", files: @files, selected_file: @selected_file %>
            
            <!-- Code Editor -->
            <div class="flex-1" id="code_editor">
              <%= render "code_editor", file: @selected_file if @selected_file %>
            </div>
          </div>
        </div>
        
        <!-- Files Panel -->
        <div class="h-full hidden p-6" data-tabs-target="panel" data-panel-name="files">
          <div class="max-w-4xl mx-auto">
            <h3 class="text-white text-lg font-semibold mb-4">Project Files</h3>
            <div class="bg-gray-800 rounded-lg overflow-hidden">
              <table class="w-full">
                <thead>
                  <tr class="border-b border-gray-700">
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Name</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Type</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Size</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Modified</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-gray-700">
                  <% @files.each do |file| %>
                    <tr class="hover:bg-gray-700">
                      <td class="px-4 py-3">
                        <div class="flex items-center">
                          <i class="<%= file_icon(file.file_type) %> mr-2 text-gray-400"></i>
                          <span class="text-gray-300"><%= file.path %></span>
                        </div>
                      </td>
                      <td class="px-4 py-3 text-sm text-gray-400"><%= file.file_type %></td>
                      <td class="px-4 py-3 text-sm text-gray-400"><%= number_to_human_size(file.size_bytes) %></td>
                      <td class="px-4 py-3 text-sm text-gray-400"><%= time_ago_in_words(file.updated_at) %> ago</td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>