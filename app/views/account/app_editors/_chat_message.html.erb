<div class="<%= message.role == 'user' ? 'ml-8' : '' %>">
  <div class="flex items-start space-x-2">
    <% if message.role == 'assistant' %>
      <div class="w-8 h-8 bg-primary-600 rounded-lg flex items-center justify-center flex-shrink-0">
        <i class="fas fa-robot text-white text-sm"></i>
      </div>
    <% end %>
    
    <div class="flex-1 <%= message.role == 'user' ? 'bg-gray-700' : 'bg-gray-750' %> rounded-lg px-4 py-2 overflow-hidden">
      <% if message.role == 'user' %>
        <div class="text-xs text-gray-400 mb-1">You</div>
      <% end %>
      
      <div class="text-sm text-gray-200 break-words" 
           data-controller="expandable-text"
           data-expandable-text-collapsed-height-value="100">
        <div data-expandable-text-target="content" class="relative">
          <%= simple_format(message.content, {}, sanitize: false) %>
        </div>
        <button data-expandable-text-target="toggle" 
                data-action="click->expandable-text#toggle"
                class="hidden text-xs text-primary-400 hover:text-primary-300 mt-2">
          <span data-expandable-text-target="showMore">Show more</span>
          <span data-expandable-text-target="showLess" class="hidden">Show less</span>
        </button>
      </div>
      
      <% if message.role == 'assistant' && message.status.present? %>
        <div class="mt-2 flex items-center text-xs text-gray-400">
          <i class="<%= message.status_icon %> mr-2"></i>
          <%= message.status_text %>
        </div>
      <% end %>
      
      <% if message.role == 'assistant' && message.status == 'completed' %>
        <% version = message.app_version || message.app.app_versions.order(created_at: :desc).first %>
        <% if version %>
          <div class="mt-3 pt-2 border-t border-gray-600">
            <div class="flex items-center justify-between text-xs text-gray-400 mb-2">
              <span>
                <i class="fas fa-code-branch mr-1"></i>
                Version <%= version.version_number %>
              </span>
              <span class="text-gray-500">
                <%= time_ago_in_words(version.created_at) %> ago
              </span>
            </div>
            
            <div class="flex space-x-2">
              <button onclick="window.postMessage({action: 'preview', version: '<%= version.id %>'}, '*')"
                      class="text-xs bg-primary-600 hover:bg-primary-700 text-white px-3 py-1 rounded flex items-center">
                <i class="fas fa-eye mr-1"></i>
                Preview
              </button>
              
              <button onclick="window.postMessage({action: 'compare', version: '<%= version.id %>'}, '*')"
                      class="text-xs bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded flex items-center">
                <i class="fas fa-balance-scale mr-1"></i>
                Compare
              </button>
              
              <% if version.changelog.present? %>
                <div class="flex-1 text-xs text-gray-500 pl-2 truncate">
                  <%= version.changelog %>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
    
    <% if message.role == 'user' %>
      <div class="w-8 h-8 bg-gray-600 rounded-lg flex items-center justify-center flex-shrink-0">
        <i class="fas fa-user text-white text-sm"></i>
      </div>
    <% end %>
  </div>
</div>