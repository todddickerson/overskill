<% content_for :title, "Dashboard" %>
<% content_for :description, "Welcome back! Here's an overview of your team's activity." %>

<!-- Generator Prompt Box - Front and Center -->
<% if @team.apps.empty? %>
  <!-- Prominent prompt for new users -->
  <div class="mb-8">
    <div class="text-center mb-6">
      <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">
        Ready to build something amazing?
      </h2>
      <p class="text-gray-600 dark:text-gray-400">
        Describe your idea and watch AI bring it to life in seconds
      </p>
    </div>
    <%= render 'shared/generator_prompt', 
               compact: false, 
               user_signed_in: true,
               show_templates: true %>
  </div>
<% else %>
  <!-- Compact prompt for existing users -->
  <div class="mb-8">
    <%= render 'shared/generator_prompt', 
               compact: true, 
               user_signed_in: true,
               show_templates: false %>
  </div>
<% end %>

<!-- Stats Grid -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
  <!-- Total Apps Card -->
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 card-hover">
    <div class="flex items-center justify-between mb-4">
      <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center">
        <i class="fas fa-cube text-white text-lg"></i>
      </div>
      <div class="flex items-center space-x-1 text-green-600 dark:text-green-400 text-sm">
        <i class="fas fa-arrow-up text-xs"></i>
        <span>12%</span>
      </div>
    </div>
    <h3 class="text-2xl font-bold text-gray-900 dark:text-white"><%= @team.apps.count %></h3>
    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Total Apps</p>
    <div class="mt-3 pt-3 border-t border-gray-100 dark:border-gray-700">
      <div class="flex items-center justify-between text-xs">
        <span class="text-gray-500 dark:text-gray-400">Published</span>
        <span class="font-semibold text-gray-900 dark:text-white"><%= @team.apps.where(status: 'published').count %></span>
      </div>
    </div>
  </div>

  <!-- Recent Activity Card -->
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 card-hover">
    <div class="flex items-center justify-between mb-4">
      <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center">
        <i class="fas fa-bolt text-white text-lg"></i>
      </div>
      <div class="flex items-center space-x-1 text-green-600 dark:text-green-400 text-sm">
        <i class="fas fa-arrow-up text-xs"></i>
        <span>23%</span>
      </div>
    </div>
    <h3 class="text-2xl font-bold text-gray-900 dark:text-white">
      <%= AppGeneration.joins(:app).where(app: { team: @team }).where('app_generations.created_at > ?', 7.days.ago).count %>
    </h3>
    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Generations (7d)</p>
    <div class="mt-3 pt-3 border-t border-gray-100 dark:border-gray-700">
      <div class="flex items-center justify-between text-xs">
        <span class="text-gray-500 dark:text-gray-400">This month</span>
        <span class="font-semibold text-gray-900 dark:text-white">
          <%= AppGeneration.joins(:app).where(app: { team: @team }).where('app_generations.created_at > ?', 30.days.ago).count %>
        </span>
      </div>
    </div>
  </div>

  <!-- Team Members Card -->
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 card-hover">
    <div class="flex items-center justify-between mb-4">
      <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center">
        <i class="fas fa-users text-white text-lg"></i>
      </div>
      <div class="flex items-center space-x-1 text-gray-500 dark:text-gray-400 text-sm">
        <i class="fas fa-minus text-xs"></i>
        <span>0%</span>
      </div>
    </div>
    <h3 class="text-2xl font-bold text-gray-900 dark:text-white"><%= @team.memberships.count %></h3>
    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Team Members</p>
    <div class="mt-3 pt-3 border-t border-gray-100 dark:border-gray-700">
      <div class="flex items-center justify-between text-xs">
        <span class="text-gray-500 dark:text-gray-400">Active today</span>
        <span class="font-semibold text-gray-900 dark:text-white">
          <%= @team.memberships.joins(:user).where('users.last_sign_in_at > ?', 1.day.ago).count %>
        </span>
      </div>
    </div>
  </div>

  <!-- Revenue/Credits Card -->
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 card-hover">
    <div class="flex items-center justify-between mb-4">
      <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-yellow-500 to-yellow-600 flex items-center justify-center">
        <i class="fas fa-chart-line text-white text-lg"></i>
      </div>
      <div class="flex items-center space-x-1 text-green-600 dark:text-green-400 text-sm">
        <i class="fas fa-arrow-up text-xs"></i>
        <span>8%</span>
      </div>
    </div>
    <h3 class="text-2xl font-bold text-gray-900 dark:text-white">$2,450</h3>
    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Revenue (30d)</p>
    <div class="mt-3 pt-3 border-t border-gray-100 dark:border-gray-700">
      <div class="flex items-center justify-between text-xs">
        <span class="text-gray-500 dark:text-gray-400">Credits used</span>
        <span class="font-semibold text-gray-900 dark:text-white">1,234</span>
      </div>
    </div>
  </div>
</div>

<!-- Main Content Grid -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
  <!-- Recent Apps (2/3 width) -->
  <div class="lg:col-span-2">
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
      <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Recent Apps</h2>
          <%= link_to account_team_apps_path(@team), class: "text-sm text-yellow-600 hover:text-yellow-700 dark:text-yellow-400 dark:hover:text-yellow-300 font-medium" do %>
            View all <i class="fas fa-arrow-right ml-1 text-xs"></i>
          <% end %>
        </div>
      </div>
      
      <div class="divide-y divide-gray-200 dark:divide-gray-700">
        <% @team.apps.order(created_at: :desc).limit(5).each do |app| %>
          <div class="px-6 py-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors">
            <div class="flex items-center justify-between">
              <div class="flex items-center space-x-4">
                <div class="w-10 h-10 rounded-lg bg-gradient-to-br <%= ['from-blue-400 to-blue-600', 'from-green-400 to-green-600', 'from-purple-400 to-purple-600', 'from-pink-400 to-pink-600', 'from-yellow-400 to-yellow-600'].sample %> flex items-center justify-center text-white font-bold">
                  <%= app.name[0].upcase %>
                </div>
                <div>
                  <%= link_to account_app_editor_path(app), class: "font-medium text-gray-900 dark:text-white hover:text-yellow-600 dark:hover:text-yellow-400" do %>
                    <%= app.name %>
                  <% end %>
                  <p class="text-sm text-gray-500 dark:text-gray-400">
                    <%= app.app_type.humanize %> â€¢ Created <%= app.created_at.strftime("%b %d") %>
                  </p>
                </div>
              </div>
              
              <div class="flex items-center space-x-3">
                <span class="<%= app.status == 'published' ? 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400' : 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-400' %> text-xs px-2 py-1 rounded-full font-medium">
                  <%= app.status.capitalize %>
                </span>
                <div class="flex items-center space-x-1">
                  <% if app.preview_url.present? %>
                    <%= link_to app.preview_url, target: "_blank", class: "p-1.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300" do %>
                      <i class="fas fa-external-link-alt text-sm"></i>
                    <% end %>
                  <% end %>
                  <%= link_to account_app_editor_path(app), class: "p-1.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300" do %>
                    <i class="fas fa-cog text-sm"></i>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        <% end %>
        
        <% if @team.apps.empty? %>
          <div class="px-6 py-12 text-center">
            <i class="fas fa-cube text-4xl text-gray-300 dark:text-gray-600 mb-3"></i>
            <p class="text-gray-500 dark:text-gray-400">No apps yet</p>
            <%= link_to generator_index_path, class: "mt-3 inline-flex items-center text-sm font-medium text-yellow-600 hover:text-yellow-700 dark:text-yellow-400 dark:hover:text-yellow-300" do %>
              Create your first app <i class="fas fa-arrow-right ml-1"></i>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Activity Feed (1/3 width) -->
  <div class="lg:col-span-1">
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
      <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
        <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Recent Activity</h2>
      </div>
      
      <div class="px-6 py-4 space-y-4 max-h-96 overflow-y-auto">
        <% activities = [] %>
        <% @team.apps.order(created_at: :desc).limit(3).each do |app| %>
          <% activities << { type: 'app_created', item: app, time: app.created_at } %>
        <% end %>
        <% AppGeneration.joins(:app).where(app: { team: @team }).order(created_at: :desc).limit(5).each do |gen| %>
          <% activities << { type: 'generation', item: gen, time: gen.created_at } %>
        <% end %>
        <% activities.sort_by { |a| -a[:time].to_i }.first(8).each do |activity| %>
          <div class="flex space-x-3">
            <div class="flex-shrink-0">
              <div class="w-8 h-8 rounded-full <%= activity[:type] == 'app_created' ? 'bg-blue-100 dark:bg-blue-900/30' : 'bg-green-100 dark:bg-green-900/30' %> flex items-center justify-center">
                <i class="fas <%= activity[:type] == 'app_created' ? 'fa-plus text-blue-600 dark:text-blue-400' : 'fa-bolt text-green-600 dark:text-green-400' %> text-xs"></i>
              </div>
            </div>
            <div class="flex-1 min-w-0">
              <p class="text-sm text-gray-900 dark:text-white">
                <% if activity[:type] == 'app_created' %>
                  New app created: <span class="font-medium"><%= activity[:item].name %></span>
                <% else %>
                  Generated update for <span class="font-medium"><%= activity[:item].app.name %></span>
                <% end %>
              </p>
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                <%= time_ago_in_words(activity[:time]) %> ago
              </p>
            </div>
          </div>
        <% end %>
        
        <% if activities.empty? %>
          <div class="text-center py-8">
            <i class="fas fa-history text-3xl text-gray-300 dark:text-gray-600 mb-3"></i>
            <p class="text-sm text-gray-500 dark:text-gray-400">No recent activity</p>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 mt-6">
      <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
        <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Quick Actions</h2>
      </div>
      
      <div class="p-6 space-y-3">
        <%= link_to generator_index_path, class: "w-full flex items-center justify-between p-3 rounded-lg bg-gradient-to-r from-yellow-50 to-yellow-100 dark:from-yellow-900/20 dark:to-yellow-900/30 hover:from-yellow-100 hover:to-yellow-200 dark:hover:from-yellow-900/30 dark:hover:to-yellow-900/40 transition-colors group" do %>
          <div class="flex items-center space-x-3">
            <i class="fas fa-magic text-yellow-600 dark:text-yellow-400"></i>
            <span class="text-sm font-medium text-gray-900 dark:text-white">Create New App</span>
          </div>
          <i class="fas fa-arrow-right text-yellow-600 dark:text-yellow-400 text-xs group-hover:translate-x-1 transition-transform"></i>
        <% end %>
        
        <%= link_to account_team_memberships_path(@team), class: "w-full flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors group" do %>
          <div class="flex items-center space-x-3">
            <i class="fas fa-user-plus text-gray-600 dark:text-gray-400"></i>
            <span class="text-sm font-medium text-gray-900 dark:text-white">Invite Member</span>
          </div>
          <i class="fas fa-arrow-right text-gray-400 text-xs group-hover:translate-x-1 transition-transform"></i>
        <% end %>
        
        <%= link_to edit_account_team_path(@team), class: "w-full flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors group" do %>
          <div class="flex items-center space-x-3">
            <i class="fas fa-cog text-gray-600 dark:text-gray-400"></i>
            <span class="text-sm font-medium text-gray-900 dark:text-white">Team Settings</span>
          </div>
          <i class="fas fa-arrow-right text-gray-400 text-xs group-hover:translate-x-1 transition-transform"></i>
        <% end %>
      </div>
    </div>
  </div>
</div>

<!-- Apps Section -->
<div class="mt-8">
  <%= render 'account/apps/modern_index', apps: @team.apps, hide_back: true %>
</div>