#!/bin/bash
# OverSkill Quick Setup Script

echo "ğŸš€ Setting up OverSkill platform..."

# Check Ruby version
RUBY_VERSION=$(ruby -v | awk '{print $2}')
REQUIRED_VERSION="3.2.0"

if [ "$(printf '%s\n' "$REQUIRED_VERSION" "$RUBY_VERSION" | sort -V | head -n1)" != "$REQUIRED_VERSION" ]; then 
    echo "âŒ Ruby $REQUIRED_VERSION or higher required. Current: $RUBY_VERSION"
    exit 1
fi

# Check for required services
command -v psql >/dev/null 2>&1 || { echo "âŒ PostgreSQL required but not installed."; exit 1; }
command -v redis-server >/dev/null 2>&1 || { echo "âŒ Redis required but not installed."; exit 1; }
command -v node >/dev/null 2>&1 || { echo "âŒ Node.js required but not installed."; exit 1; }

echo "âœ… Dependencies verified"

# Copy environment file
if [ ! -f .env ]; then
    echo "ğŸ“ Creating .env file..."
    cp .env.example .env
    echo "âš ï¸  Please edit .env with your API keys!"
else
    echo "âœ… .env file exists"
fi

# Install gems
echo "ğŸ’ Installing Ruby gems..."
bundle install

# Install JavaScript packages
echo "ğŸ“¦ Installing JavaScript packages..."
yarn install

# Setup database
echo "ğŸ—„ï¸  Setting up database..."
bin/rails db:create
bin/rails db:migrate
bin/rails db:seed

# Run BulletTrain configuration
echo "ğŸš„ Running BulletTrain configuration..."
bin/configure

echo ""
echo "âœ… Setup complete!"
echo ""
echo "Next steps:"
echo "1. Edit .env with your API keys"
echo "2. Run 'bin/dev' to start the server"
echo "3. Visit http://localhost:3000"
echo ""
echo "To generate your first model:"
echo "rails generate super_scaffold YourModel Team field:type"
echo ""
echo "Happy building! ğŸ‰"
